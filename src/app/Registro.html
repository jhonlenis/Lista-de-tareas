<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Autenticación</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .login-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 420px;
      padding: 30px;
      transition: all 0.3s ease;
    }
    
    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 24px;
      font-weight: 600;
    }
    
    .form-group {
      margin-bottom: 20px;
      position: relative;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #555;
      font-size: 14px;
    }
    
    input {
      width: 100%;
      padding: 14px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border 0.3s ease;
    }
    
    input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
    }
    
    input.error {
      border-color: #ff4757;
    }
    
    .error-message {
      color: #ff4757;
      font-size: 12px;
      margin-top: 5px;
      display: block;
    }
    
    .password-toggle {
      position: absolute;
      right: 12px;
      top: 38px;
      background: none;
      border: none;
      color: #777;
      cursor: pointer;
      font-size: 14px;
    }
    
    .submit-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      margin-top: 10px;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .submit-btn:active {
      transform: translateY(0);
    }
    
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .message {
      text-align: center;
      padding: 12px;
      margin: 15px 0;
      border-radius: 8px;
      font-size: 14px;
    }
    
    .success {
      background-color: #d4edda;
      color: #155724;
    }
    
    .error {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .info {
      background-color: #d1ecf1;
      color: #0c5460;
    }
    
    .toggle-form {
      text-align: center;
      margin-top: 20px;
      color: #666;
      font-size: 14px;
    }
    
    .toggle-link {
      color: #667eea;
      cursor: pointer;
      font-weight: 600;
      transition: color 0.2s ease;
    }
    
    .toggle-link:hover {
      color: #764ba2;
      text-decoration: underline;
    }
    
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .success-checkmark {
      display: inline-block;
      width: 20px;
      height: 20px;
      margin-right: 8px;
      vertical-align: middle;
    }
    
    .success-checkmark:after {
      content: "✓";
      color: #155724;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    const { useState, useEffect } = React;

    function Login({ onLogin }) {
      const [isLogin, setIsLogin] = useState(true);
      const [formData, setFormData] = useState({
        name: '',
        email: '',
        password: ''
      });
      const [errors, setErrors] = useState({});
      const [message, setMessage] = useState({ text: '', type: '' });
      const [isLoading, setIsLoading] = useState(false);
      const [showPassword, setShowPassword] = useState(false);
      const [users, setUsers] = useState([]);

      const validateField = (name, value) => {
        let error = '';
        
        switch (name) {
          case 'name':
            if (!isLogin && !value.trim()) {
              error = 'El nombre es obligatorio';
            } else if (!isLogin && value.length < 2) {
              error = 'El nombre debe tener al menos 2 caracteres';
            }
            break;
          case 'email':
            if (!value) {
              error = 'El email es obligatorio';
            } else if (!/\S+@\S+\.\S+/.test(value)) {
              error = 'El formato del email no es válido';
            }
            break;
          case 'password':
            if (!value) {
              error = 'La contraseña es obligatoria';
            } else if (value.length < 6) {
              error = 'La contraseña debe tener al menos 6 caracteres';
            }
            break;
          default:
            break;
        }
        
        return error;
      };

      const handleChange = (e) => {
        const { name, value } = e.target;
        setFormData({
          ...formData,
          [name]: value
        });
        
        // Validación en tiempo real después de escribir
        if (errors[name]) {
          const error = validateField(name, value);
          setErrors({
            ...errors,
            [name]: error
          });
        }
      };

      const handleBlur = (e) => {
        const { name, value } = e.target;
        const error = validateField(name, value);
        setErrors({
          ...errors,
          [name]: error
        });
      };

      const validateForm = () => {
        const newErrors = {};
        
        if (!isLogin) {
          const nameError = validateField('name', formData.name);
          if (nameError) newErrors.name = nameError;
        }
        
        const emailError = validateField('email', formData.email);
        if (emailError) newErrors.email = emailError;
        
        const passwordError = validateField('password', formData.password);
        if (passwordError) newErrors.password = passwordError;
        
        setErrors(newErrors);
        
        return Object.keys(newErrors).length === 0;
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        
        if (!validateForm()) {
          setMessage({ text: 'Por favor, corrige los errores en el formulario', type: 'error' });
          return;
        }
        
        setIsLoading(true);
        setMessage({ text: isLogin ? 'Iniciando sesión...' : 'Creando cuenta...', type: 'info' });
        
        // Simular una llamada a API
        setTimeout(() => {
          setIsLoading(false);
          
          if (isLogin) {
            // Verificar credenciales para inicio de sesión
            const user = users.find(u => u.email === formData.email && u.password === formData.password);
            
            if (user) {
              setMessage({ 
                text: '¡Inicio de sesión exitoso!', 
                type: 'success' 
              });
              
              // Llamar a la función onLogin después de un breve delay para mostrar el mensaje
              setTimeout(() => onLogin(user), 1000);
            } else {
              setMessage({ 
                text: 'Credenciales incorrectas. Verifica tu email y contraseña.', 
                type: 'error' 
              });
            }
          } else {
            // Verificar si el usuario ya existe para registro
            const userExists = users.some(u => u.email === formData.email);
            
            if (userExists) {
              setMessage({ 
                text: 'Este email ya está registrado. Inicia sesión o usa otro email.', 
                type: 'error' 
              });
            } else {
              // Crear nuevo usuario
              const newUser = {
                id: Date.now(),
                name: formData.name,
                email: formData.email,
                password: formData.password
              };
              
              // Guardar el nuevo usuario en el estado (solo para esta sesión)
              setUsers([...users, newUser]);
              
              setMessage({ 
                text: '¡Cuenta creada exitosamente! Ahora puedes iniciar sesión.', 
                type: 'success' 
              });
              
              // Cambiar a modo de inicio de sesión después de registrar
              setTimeout(() => {
                setIsLogin(true);
                setFormData({
                  ...formData,
                  name: '', // Limpiar el nombre para el formulario de login
                  password: '' // Limpiar la contraseña
                });
              }, 1500);
            }
          }
        }, 1500);
      };

      const togglePasswordVisibility = () => {
        setShowPassword(!showPassword);
      };

      const toggleFormMode = () => {
        setIsLogin(!isLogin);
        setErrors({});
        setMessage({ text: '', type: '' });
        // Limpiar contraseña al cambiar de modo
        setFormData({
          ...formData,
          password: ''
        });
      };

      return (
        <div className="login-container">
          <h2>{isLogin ? 'Iniciar Sesión' : 'Crear Cuenta'}</h2>
          <form onSubmit={handleSubmit}>
            {!isLogin && (
              <div className="form-group">
                <label htmlFor="name">Nombre</label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  placeholder="Tu nombre completo"
                  value={formData.name}
                  onChange={handleChange}
                  onBlur={handleBlur}
                  className={errors.name ? 'error' : ''}
                />
                {errors.name && <span className="error-message">{errors.name}</span>}
              </div>
            )}
            <div className="form-group">
              <label htmlFor="email">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="tu.email@ejemplo.com"
                value={formData.email}
                onChange={handleChange}
                onBlur={handleBlur}
                className={errors.email ? 'error' : ''}
              />
              {errors.email && <span className="error-message">{errors.email}</span>}
            </div>
            <div className="form-group">
              <label htmlFor="password">Contraseña</label>
              <input
                type={showPassword ? "text" : "password"}
                id="password"
                name="password"
                placeholder="Mínimo 6 caracteres"
                value={formData.password}
                onChange={handleChange}
                onBlur={handleBlur}
                className={errors.password ? 'error' : ''}
              />
              <button 
                type="button" 
                className="password-toggle"
                onClick={togglePasswordVisibility}
              >
                {showPassword ? 'Ocultar' : 'Mostrar'}
              </button>
              {errors.password && <span className="error-message">{errors.password}</span>}
            </div>
            <button 
              type="submit" 
              className="submit-btn"
              disabled={isLoading}
            >
              {isLoading ? (
                <>
                  <span className="loader"></span>
                  {isLogin ? 'Iniciando sesión...' : 'Creando cuenta...'}
                </>
              ) : (
                isLogin ? 'Iniciar Sesión' : 'Registrarse'
              )}
            </button>
          </form>
          
          {message.text && (
            <div className={`message ${message.type}`}>
              {message.type === 'success' && <span className="success-checkmark"></span>}
              {message.text}
            </div>
          )}
          
          <p className="toggle-form">
            {isLogin ? '¿No tienes una cuenta? ' : '¿Ya tienes una cuenta? '}
            <span onClick={toggleFormMode} className="toggle-link">
              {isLogin ? 'Regístrate aquí' : 'Inicia sesión aquí'}
            </span>
          </p>
        </div>
      );
    }

    function App() {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [user, setUser] = useState(null);
      
      const handleLogin = (userData) => {
        setUser(userData);
        setIsLoggedIn(true);
      };
      
      const handleLogout = () => {
        setUser(null);
        setIsLoggedIn(false);
      };
      
      if (isLoggedIn) {
        return (
          <div className="login-container">
            <h2>¡Bienvenido, {user.name}!</h2>
            <p>Has iniciado sesión correctamente con el email: {user.email}</p>
            <button className="submit-btn" onClick={handleLogout}>
              Cerrar Sesión
            </button>
          </div>
        );
      }
      
      return <Login onLogin={handleLogin} />;
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>